<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>云枢二开 | huashuocuicui</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/huashuocuicuiBlog/myico.ico">
    <meta name="description" content="huashuocuicui boke!">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="preload" href="/huashuocuicuiBlog/assets/css/0.styles.5fe97a94.css" as="style"><link rel="preload" href="/huashuocuicuiBlog/assets/js/app.c8e5c8f8.js" as="script"><link rel="preload" href="/huashuocuicuiBlog/assets/js/3.42fde2ec.js" as="script"><link rel="preload" href="/huashuocuicuiBlog/assets/js/1.5598d007.js" as="script"><link rel="preload" href="/huashuocuicuiBlog/assets/js/30.776a3768.js" as="script"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/10.78d44288.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/11.0022be70.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/12.d4b6cdff.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/13.0f94442d.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/14.c23a5fb5.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/15.9585bcff.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/16.fe635c93.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/17.3aa9b3e4.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/18.ec58f518.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/19.c18233cf.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/20.55f1f14b.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/21.4c284338.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/22.acde6d21.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/23.4341a7d4.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/24.44f3d890.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/25.f7d2d4f1.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/26.1d1dfd8c.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/27.fd70bd9e.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/28.ef73aa07.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/29.e7dafa39.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/31.d1ee65ac.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/32.89f3bd70.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/33.fea753d9.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/4.a38926ae.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/5.5fff6cd9.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/6.6add3dcf.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/7.aec52559.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/8.4b15852b.js"><link rel="prefetch" href="/huashuocuicuiBlog/assets/js/9.264a4ecb.js">
    <link rel="stylesheet" href="/huashuocuicuiBlog/assets/css/0.styles.5fe97a94.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-dad8a512><div data-v-dad8a512><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-dad8a512 data-v-dad8a512><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-dad8a512 data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>huashuocuicui</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>hushuocuicui</span>
            
          <span data-v-64685f0e>2019 - </span>
          2020
        </a></span></div></div> <div class="hide" data-v-dad8a512><header class="navbar" data-v-dad8a512><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/huashuocuicuiBlog/" class="home-link router-link-active"><img src="/huashuocuicuiBlog/head.png" alt="huashuocuicui" class="logo"> <span class="site-name">huashuocuicui</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/huashuocuicuiBlog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      类别
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/category1/" class="nav-link"><i class="iconfont undefined"></i>
  category1
</a></li><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/test/" class="nav-link"><i class="iconfont undefined"></i>
  test
</a></li><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li></ul></div></div><div class="nav-item"><a href="/huashuocuicuiBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/huashuocuicuiBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/huashuocuicuiBlog/views/sidebargroup/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  authine
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-dad8a512></div> <aside class="sidebar" data-v-dad8a512><div class="personal-info-wrapper" data-v-ca798c94 data-v-dad8a512><img src="/huashuocuicuiBlog/head.png" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    hushuocuicui
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>10</h3> <h6 data-v-ca798c94>Article</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>6</h3> <h6 data-v-ca798c94>Tag</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><a href="/huashuocuicuiBlog/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      类别
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/category1/" class="nav-link"><i class="iconfont undefined"></i>
  category1
</a></li><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/other/" class="nav-link"><i class="iconfont undefined"></i>
  other
</a></li><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/test/" class="nav-link"><i class="iconfont undefined"></i>
  test
</a></li><li class="dropdown-item"><!----> <a href="/huashuocuicuiBlog/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li></ul></div></div><div class="nav-item"><a href="/huashuocuicuiBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/huashuocuicuiBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/huashuocuicuiBlog/views/sidebargroup/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  authine
</a></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>H3·BPM</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>奥哲·云枢</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/huashuocuicuiBlog/views/sidebargroup/云枢概括.html" class="sidebar-link">云枢概括</a></li><li><a href="/huashuocuicuiBlog/views/sidebargroup/云枢二开.html" class="active sidebar-link">云枢二开</a></li><li><a href="/huashuocuicuiBlog/views/sidebargroup/云枢配置.html" class="sidebar-link">云枢配置-API</a></li><li><a href="/huashuocuicuiBlog/views/sidebargroup/云枢知识库.html" class="sidebar-link">云枢知识库,</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-dad8a512><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>云枢二开</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>hushuocuicui</span>
            
          <span data-v-64685f0e>2019 - </span>
          2020
        </a></span></div></div> <div data-v-dad8a512><main class="page"><div class="page-title" style="display:none;"><h1>云枢二开</h1> <hr> <div data-v-aa64b9d0><i class="iconfont reco-account" data-v-aa64b9d0><span data-v-aa64b9d0>hushuocuicui</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="环境搭建"><a href="#环境搭建" class="header-anchor">#</a> 环境搭建</h2> <ol><li>安装node[npm自动安装，自动配置环境变量]</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    1. 下载node 【http://nodejs.cn/download/】
    2. 安装node 【https://www.runoob.com/nodejs/nodejs-install-setup.html】
</code></pre></div><ol start="2"><li>设置私服</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    npm set registry http://nexus.h3yun.com:8888/repository/npm-all/
</code></pre></div><ol start="3"><li>下载依赖</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    npm run installs
</code></pre></div><ol start="4"><li>配置cli（env.debug），需要分别对admin、portal、mobile分别配置</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    NODE_ENV = 'debug'
    VUE_APP_API = 'http://fangyi.scjgj.beijing.gov.cn/api'
    VUE_APP_OAUTH_HOST = 'http://fangyi.scjgj.beijing.gov.cn/api'
    VUE_APP_PORTAL_HOST = 'http://fangyi.scjgj.beijing.gov.cn/'
    VUE_APP_OAUTH_CLINET_ID = 'api'
    VUE_APP_OAUTH_SECRET = 'c31b32364ce19ca8fcd150a417ecce58'
    VUE_APP_OAUTH_SCOPE = 'read'
    VUE_APP_OAUTH_REDIRECT = 'http://127.0.0.1:9000/admin'

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>    VUE_APP_API	后端API地址
    $VUE_APP_OAUTH_HOST	后端OAuth服务地址
    VUE_APP_PORTAL_HOST	前端Portal地址
    VUE_APP_OAUTH_CLINET_ID	OAuth2 ClientId参数，需跟数据库中配置匹配
    VUE_APP_OAUTH_SECRET	OAuth2 Secret参数，需跟数据库中配置匹配
    VUE_APP_OAUTH_SCOPE	OAuth2 Scope参数，需跟数据库中配置匹配
    VUE_APP_OAUTH_REDIRECT	OAuth2 重定向地址，需跟数据库中配置匹配

</code></pre></div><ol start="5"><li>启动本地前端【在根目录启动[frontend]】</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    portal：【npm run portal】
    mobile：【npm run mobile】
    admin：【npm run admin】
</code></pre></div><ol start="6"><li>打包前端</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    portal：【npm run build-portal】
    mobile：【npm run build-mobile】
    admin：【npm run build-admin】
</code></pre></div><ol start="7"><li>打包前端</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    替换原有包【服务器原有结构与本地包结构不一样，需要改结构】
    如有缓存，重启前端【./deploy.sh frontEnd】或者重启docker
</code></pre></div><h2 id="项目工程"><a href="#项目工程" class="header-anchor">#</a> 项目工程</h2> <ol><li>package-lock.json【npm依赖包版本锁定】</li> <li>package.json   【npm配置文件】</li> <li>postcss.config.js 【CSS自动兼容配置文件】</li> <li>modules【业务模块包】@cloudpivot【业务模块命令空间】</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    1. api【后端api访问包】
    2. application 【应用、数据模型模块组件】
    3. common【公共包，公共组件、指令、LESS函数、工具函数】
    4. flow【流程模块包，流程相关组件，流程状态、审批意见、流程信息等】
    5. flow-center【流程中心模块包，流程中心相关组件】
    6. flow-drawer【流程绘制器】
    7. form【表单模块包，表单相关组件，表单定义、渲染器、运行时组件】
    8. list【列表模块包】
    9. platform 【平台环境包、钉钉环境适配】
</code></pre></div><h2 id="代码结构-entries【入口项目】"><a href="#代码结构-entries【入口项目】" class="header-anchor">#</a> 代码结构 --entries【入口项目】</h2> <h3 id="portal"><a href="#portal" class="header-anchor">#</a> portal</h3> <ol><li>public【静态资源文件夹，静态资源须放到这里】</li> <li>src【源码目录】</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    1. apis【后台api访问包】
    2. assets【项目图标图片】
    3. common【全局公告目录，遗留】
    4. components【项目组件，遗留】
    5. config【项目全局第三方库配置】
    6. directives【全局指令】
    7. locale【多语言文件】
    8. mixins【Vue mixin文件，灵活的组件可复用】
    9. routes【路由】
    10. store【vuex，数据状态管理】
    11. styles【全局样式】
    12. typings【Typescript类型文件，d.ts文件】
    13. utils【工具函数】
    14. views【vue页面组件】
    15. app.vue【vue根组件】
    16. main.ts【前端入口文件】
     
</code></pre></div><ol start="3"><li>browserslistrc【浏览器兼容列表】</li> <li>env.debug 【vue cli环境配置文件】</li> <li>babel.config.js【babel配置文件，语法编译】</li> <li>jest.config.js【jest配置文件，单元测试】</li> <li>tsconfig.json【typescript配置文件】</li> <li>vue.config.js【vue cli配置文件】</li> <li>extends(二开专用),二开尽量放到这个文件夹</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    1. theme.js【主题】
    2. api.ts【提交api】
    3. site【站点信息】
    4. routes【路由】
    5. 基于模块包组件开发【modules/@cloudpivot】
    6. 二开步骤
        a. 后台管理配置路由地址【/application/{appcode}/{页面}】【必须挂在在application下面】
        b. extend 下新建组件【页面】
        c. 配置路由【/extends/routes.ts】
</code></pre></div><ol start="10"><li>表单组件二开[版本1.7+]</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    1. 表单二开文档：modules/@cloudpivot/form/doc/云枢表单组件开发手册.md
    2. 二开组件存放位置：modules/@cloudpivot/form/components-extend
    3. 二开组件注册到组件库：@cloudpivot/form/registerComponent.ts
</code></pre></div><h3 id="mobile"><a href="#mobile" class="header-anchor">#</a> mobile</h3> <div class="language- extra-class"><pre class="language-text"><code>    同portal一样
</code></pre></div><h3 id="admin"><a href="#admin" class="header-anchor">#</a> admin</h3> <div class="language- extra-class"><pre class="language-text"><code>    同portal一样
</code></pre></div><h2 id="二开规范"><a href="#二开规范" class="header-anchor">#</a> 二开规范</h2> <h3 id="theme-js-样式变量"><a href="#theme-js-样式变量" class="header-anchor">#</a> theme.js 样式变量</h3> <div class="custom-block danger"><div class="language- extra-class"><pre><code>二次开发的内容必须放在extends文件夹下，应避免修改extends文件夹以外的内容，否则后续版本升级造成代码冲突等不必要的麻烦。
</code></pre></div></div> <div class="language- extra-class"><pre class="language-text"><code>    //如果将项目的主题色改为红色，只需在extends/theme.js，加入如下代码即可：
    module.exports = {
        'primary-color': 'red'
    };
    //error-bd-color 错误边框色 error-bg-color 错误背景色 error-color 错误字体色
    //border-radius-base 边框圆角基础值 border-radius-lg 边框圆角大号值
    //font-size-base 基础 font-size-sm 小号 font-size-md 中号
</code></pre></div><h3 id="api-ts-api-url"><a href="#api-ts-api-url" class="header-anchor">#</a> api.ts API URL</h3> <div class="language- extra-class"><pre class="language-text"><code>    // 一级命名空间
    application 应用中心
    workflow 流程相关
    user 用户信息
    organization 机构
    form 表单

    //如果需要将表单提交的API覆盖，只需在extends/api.ts，加入如下代码即可：
    module.exports = {
        form: {
            submit:'/aa'
        }
    };
</code></pre></div><h3 id="site-ts-站点信息"><a href="#site-ts-站点信息" class="header-anchor">#</a> site.ts 站点信息</h3> <div class="language- extra-class"><pre class="language-text"><code>    title 站点标题
    logo 站点Logo，语法为：require('@/../extends/logo.png')
</code></pre></div><h3 id="routes-ts-路由"><a href="#routes-ts-路由" class="header-anchor">#</a> routes.ts 路由</h3> <div class="language- extra-class"><pre class="language-text"><code>    //如果需要覆盖默认的路由，以portal项目为例，在extends/routes.ts，加入如下代码即可
    export default {
        formDetail: {
            path: '/form/detail',
            name: 'form-detail',
            component: () =&gt; import('@/views/form/form-detail.vue')
        }
    } as any;
</code></pre></div><h3 id="基于模块包组件开发"><a href="#基于模块包组件开发" class="header-anchor">#</a> 基于模块包组件开发</h3> <p>快速构建自己的页面级组件，而不必重新开发，目前有两种方式：</p> <ol><li>组合业务模块组件</li> <li>继承组件类重写模板，但目前只有表单详情支持。
业务模块中的大组件也由小组件组合成，组件类通过继承，只需处理页面跳转、入口特有的交互等。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>    //以PC端表单详情为例，它由@cloudpivot/flow的审批记录组件和@cloudpivot/form的表单渲染器、表单运行组件（按钮、按钮弹窗）构成，模板详情如下：
    &lt;template&gt;
        &lt;div class=&quot;form-detail&quot;&gt;
            &lt;form-detail-header&gt;
            &lt;!--按钮栏--&gt;
            &lt;form-actions :actions=&quot;actions&quot; @action=&quot;onAction&quot;&gt;&lt;/form-actions&gt;
            &lt;/form-detail-header&gt;

            &lt;div class=&quot;form-body&quot; @scroll=&quot;onBodyScroll&quot;&gt;
            &lt;div class=&quot;form-wrap&quot;&gt;

                &lt;!--流程当前节点信息--&gt;
                &lt;workflow-info
                v-if=&quot;workflowInstanceId&quot;
                :id=&quot;workflowInstanceId&quot;
                :itemId=&quot;formObj.workItemId&quot;
                @flowTrack=&quot;flowTrack&quot;
                &gt;&lt;/workflow-info&gt;

                &lt;!--表单渲染器--&gt;
                &lt;pc-form-renderer ref=&quot;formRenderer&quot; :controls=&quot;controls&quot;&gt;&lt;/pc-form-renderer&gt;

                &lt;a-collapse
                v-if=&quot;workflowInstanceId&quot;
                class=&quot;workflow-collapse&quot;
                :activeKey=&quot;['approval']&quot;
                :bordered=&quot;false&quot;
                &gt;
                &lt;a-collapse-panel class=&quot;bold-collapse-panel&quot; header=&quot;审批记录&quot; key=&quot;approval&quot;&gt;

                    &lt;!--审批意见树--&gt;
                    &lt;Approval
                    :workflowInstanceId=&quot;workflowInstanceId&quot;
                    :completed=&quot;completed&quot;
                    :getFileUrlFn=&quot;getFileUrlFn&quot;
                    @download=&quot;onDownload&quot;
                    &gt;&lt;/Approval&gt;

                &lt;/a-collapse-panel&gt;
                &lt;/a-collapse&gt;

                &lt;!--按钮模态窗--&gt;
                &lt;form-action-modal ref=&quot;actionModal&quot; @ok=&quot;onOk&quot;&gt;&lt;/form-action-modal&gt;
            &lt;/div&gt;

            &lt;div v-show=&quot;showBacktop&quot; class=&quot;back-top&quot; @click=&quot;backTop&quot;&gt;
                &lt;a-icon type=&quot;up&quot;&gt;&lt;/a-icon&gt;
            &lt;/div&gt;
            &lt;/div&gt;

            &lt;a-alert v-if=&quot;comment&quot; :message=&quot;comment&quot; type=&quot;info&quot; banner closable/&gt;

            &lt;h3-message ref=&quot;h3Messsag&quot; title=&quot;已操作完成&quot; content=&quot;自动为您跳转至下一条待办&quot;&gt;&lt;/h3-message&gt;
        &lt;/div&gt;
    &lt;/template&gt;

    //假如现在表单头部需要定制，并且将表单改为左右布局，且不需要改变组件行为:
    1. 在extends目录下新建一个form文件夹
    2. 新建并重写form-detail-header.vue
    3. 新建并重写form-detail.vue
    4. 在extends/routes.ts覆盖formDetail路由
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>    //模块包介绍
    1. @cloudpivot/api 产品后端API
    2. @cloudpivot/common 公共包，公共组件、指令、LESS函数、工具函数
    3. @cloudpivot/application 应用、数据模型组件
    4. @cloudpivot/flow 流程相关组件，流程状态、审批意见、流程信息等
    5. @cloudpivot/flow-center 流程中心相关组件
    6. @cloudpivot/form 表单相关组件，表单定义、渲染器、运行时组件
    7. @cloudpivot/list 列表相关组件
</code></pre></div><h2 id="添加自定义vue页面"><a href="#添加自定义vue页面" class="header-anchor">#</a> 添加自定义Vue页面</h2> <div class="custom-block danger"><div class="language- extra-class"><pre><code>1.自定义Vue页面的菜单是挂在应用下的，所以URL和路由必须配置在/application下
2.目前添加自定义Vue页面分为 Portal端 和 Mobile端，各端的页面管理和开发都是独立的，需要分别在Portal、Mobile创建组件和配置
</code></pre></div></div> <div class="language- extra-class"><pre class="language-text"><code>    1. 登陆并进入 admin 控制面板 — 应用管理页面
    2. 在admin控制面板配置自定义页面： 点击顶部“+添加自定义页面”，选择“打开方式”为“Vue路由模式”，填写PC访问地址
    3. pc访问地址格式：/application/{appcode}/applicationDemo，如截图案例，appcode 为 ZY ，页面为 demo.vue
    4. 在portal开发前端源码目录下的 /extends 新建演示页面：demo.vue
    5. 到 /extends/routes.ts 路由文件配置自定义页面路由
        export default {
            application:{
                applicationDemo: {
                    path: 'application-demo',
                    name: 'applicationDemo',
                    component: () =&gt; import('@/../extends/demo.vue'),
                }
            }
        } as any;
</code></pre></div><h2 id="表单组件开发"><a href="#表单组件开发" class="header-anchor">#</a> 表单组件开发</h2> <div class="custom-block danger"><div class="language- extra-class"><pre><code>1.二次开发可以重写云枢表单原生组件,也可以开发新组件. 新的云枢表单组件开发模式只有在1.7及以上支持.
2. 开发手册  云枢表单组件的开发规范文档位置在: modules/@cloudpivot/form/doc/云枢表单组件开发手册.md
</code></pre></div></div> <div class="language- extra-class"><pre class="language-text"><code>    1. 二开组件的建议放到: modules/@cloudpivot/form/components-extend目录中.
    2. 定制开发组件需要引入到@cloudpivot/form/registerComponent.ts
        import component from &quot;@cloudpivot/form/src/components&quot;; // 云枢原生组件
        import { register } from &quot;@cloudpivot/form/utils/register&quot;;
        import { ComponentInfo, ComponentAsset } from &quot;@cloudpivot/form/typings&quot;;
        import extendComponent from &quot;@cloudpivot/form/components-extend&quot;; // 扩展组件
        const components = [...component,...extendComponent];
        export default function () {
            for (let cmp of components) {
                register.append(cmp);
            }
        }
</code></pre></div><h2 id="列表自定义"><a href="#列表自定义" class="header-anchor">#</a> 列表自定义</h2> <h3 id="pc端"><a href="#pc端" class="header-anchor">#</a> pc端</h3> <div class="custom-block tip"><div class="language- extra-class"><pre><code>1. PC 端和 Mobile 端皆支持视图自定义功能, 功能点包括:
    自定义样式
    自定义按钮
    自定义模板
    自定义脚本
2. 双端的特性和侧重点不同, 对自定义的支持也不同, 其中:
    自定义样式都支持
    自定义按钮不支持 Mobile 端
    自定义模板在 PC 端当前版本固定为 table, 仅支持少量自定义; Mobile 支持完全自定义;
    自定义脚本在 Mobile 端不支持自定义按钮功能, 其他方面与 PC 端无异
3. 每个视图都有各自独立的配置
4. 每个视图下的双端的配置也各自独立，互不干扰
</code></pre></div></div> <div class="language- extra-class"><pre class="language-text"><code>    1. 样式模块
        -样式控制不限于视图, 可作用于整个页面
        -但所设样式仅对当前视图页有效, 会随着页面加载卸载
        &lt;style id=&quot;customStyle&quot;&gt;
            /* 样式可对当前页面所有元素生效 */
            /* 设置顶栏背景颜色 */
            .header { background-color:#ECECEC; }
            /* 设置“新增”按钮边框颜色和背景颜色 */
            .list-action-add {
                border-color:#67C23A;
                background-color:#67C23A;
            }
        &lt;/style&gt;
    2. 按钮模块
        -PC 端有五个预设按钮: 新增、删除、导入、导出、打印二维码
        -按钮有 code、text、id、class 属性, 其中:
            code   作为唯一逻辑标识, 必填且必须在视图内唯一
            text     作为按钮名称
            id         按钮标签id, 非必填
            class   按钮标签类名, 非必填；如不定义，会默认使用 `list-action-${actionCode}`;
        -其中, 自定义按钮可修改全部属性，预设按钮不能删除，也不支持修改 code 属性
    3. 脚本模块
        -支持视图的三个生命周期:
            onPreLoad      视图数据加载前, 仅执行一次
            onLoad            视图数据加载后, 翻页或增删视图项会重新触发
            onRendered   视图渲染后, 触发规则同 onLoad
        -支持按钮操作的三个流程事件:
            onPreAction           按钮逻辑执行前, 可通过返回 false 阻拦后续按钮事件流程
            onCustomAction   自定义按钮执行逻辑（add、delete等预置按钮配有预置的执行逻辑，不开放直接更改）
            onActionDone        按钮逻辑执行完毕
    4. 脚本配置
        -options 脚本基本配置
            version 脚本支持逻辑的版本, 修改前请查阅相关更新文档, 轻易修改可能会造成脚本运行失效
        -pageConfig 页面配置 ( version: 1.1 )
            apis 替换页面接口
        -extensions 脚本内部扩展, 可自行添加变量或函数, 以供事件钩子或自定义模板 (customTemplate) 调用
        -hooks 生命周期和按钮事件的具体实现
    5. 事件字段说明:
        -隐藏字段 vm        可在所有事件钩子和自定接口函数内引用, 指向页面的 Vue 实例
        -隐藏字段 axios     可在所有事件钩子和自定接口函数内引用, 第三方 ajax 库
        -隐藏字段 config   可在所有事件钩子和自定接口函数内引用, 项目环境参数配置对象，源自项目 public/config.js
        -参数字段 data      指向当前视图页数据, onPreAction 事件外所有的钩子都包含
        -参数字段 action   按钮对象, 按钮数据格式为: { actionCode:'add', name:'新增', ... }, actionCode 作为每个按钮的唯一标识
        -参数字段 result    onActionDone 独有, 指向事件处理的结果, 由按钮执行返回 (预置按钮逻辑 | 自定义按钮逻辑)
</code></pre></div><div class="custom-block danger"><div class="language- extra-class"><pre><code>1.!注: 所有事件节点都可以通过返回 Promise | Promise.all | Promise.race 实现流程的异步串联
</code></pre></div></div> <h4 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h4> <div class="language- extra-class"><pre class="language-text"><code>    // ...这是一个完整的脚本配置
    &lt;script id=&quot;customScript&quot;&gt;
    ({
        // 脚本配置: 在对配置修改之前, 请务必认真查阅相关文档
        options: {
            version:'1.0'
        },
        // 脚本扩展, 可自行添加变量或函数, 以供事件钩子或自定义模板(customTemplate)调用
        extensions: {
            greeting:'hey!',
            doSomething() {
                console.log( this.extensions.greeting );
            }
        },
        // 事件钩子定义
        hooks: {
            // 视图数据加载前
            onPreLoad: function() {
            this.extensions.doSomething(vm);
            },
            // 视图数据加载后
            onLoad: function(data) {},
            // 视图数据渲染后
            onRendered: function(data) {},
            // 在所有按钮动作触发前, 可通过返回 false 阻拦后续按钮事件流程, 返回空或其他不阻拦
            onPreAction: function(action,data) {},
            // 自定义按钮执行逻辑
            onCustomAction: function(action,data) {},
            // 按钮事件触发完毕
            onActionDone: function(action,result) {}
        }
    })
    &lt;/script&gt;
</code></pre></div><h4 id="异步流程控制"><a href="#异步流程控制" class="header-anchor">#</a> 异步流程控制</h4> <div class="language- extra-class"><pre class="language-text"><code>    // 视图数据加载前
    onPreLoad: function() {
        return new Promise(function (resolve,reject) {
            setTimeout(function() {
                // 这里进行了一些异步操作
                console.log('这里是 onPreLoad 的异步流程');
                resolve();
            }, 1000);
        })
    },
    // 视图数据加载后
    onLoad: function(data) {
        return new Promise(function (resolve,reject) {
            setTimeout(function() {
                // 这里进行了一些异步操作
                console.log('这里是 onLoad 的异步流程');
                resolve();
            }, 1000);
        })
    },
    // 视图数据渲染后
    onRendered: function(data) {
        console.log('视图终于渲染完毕了')
    },
</code></pre></div><h4 id="按钮事件-阻挡预置按钮执行"><a href="#按钮事件-阻挡预置按钮执行" class="header-anchor">#</a> 按钮事件-阻挡预置按钮执行</h4> <div class="language- extra-class"><pre class="language-text"><code>    // 编辑 hooks 中的 onPreAction:
    onPreAction: function(action,data) {
        if ( action.actionCode==='add' ) {
            // 你可能需要做些判断, 来决定是否可以执行后续流程
            // 假设你已经做好判断, 决定对新增进行阻断, 并做个提示
            alert('新增操作发生了某些异常, 无法顺利执行');
            return false;
        }
    },
</code></pre></div><h4 id="按钮事件的流程控制"><a href="#按钮事件的流程控制" class="header-anchor">#</a> 按钮事件的流程控制</h4> <div class="language- extra-class"><pre class="language-text"><code>    onPreAction: function(action,data) {
        if ( action.actionCode==='add' ) {
            alert('新增操作发生了某些异常, 无法顺利执行');
            return false;
        }
        // 这是对 自定义按钮1 的控制, 这里使用的 actionCode 是定义按钮时设置的 code 属性
        else if ( action.actionCode==='customActionCode1' ) {
            console.log('customActionCode1 - onPreAction');
        }
    },
    onCustomAction: function(action, data) {
        // 因为 onCustomAction 是自定义按钮执行的公共通道, 所以在执行任何针对性代码之前都需要进行判断
        // 这里是 自定义按钮1 的执行逻辑
        if ( action.actionCode==='customActionCode1' ) {
            // 获取当前时间的毫秒数
            var nowTimeStamp = Date.now();
            var isEvenNumber = nowTimeStamp%2 === 0

            // 如果毫秒数为偶数, 执行异步流程
            if ( isEvenNumber ) {
                return new Promise(function(resolve,reject) {
                    setTimeout(function() {
                        console.warn('customActionCode1 - onCustomAction: 异步流程')
                        resolve({ isEvenNumber, nowTimeStamp });
                    },1000);
                });
            }
            else {
                console.log('customActionCode1 - onCustomAction: 同步流程')
                return { isEvenNumber, nowTimeStamp };
            }
        }
    },
    onActionDone: function(action, result) {
        // 因为 onActionDone 是所有按钮执行完毕的公共通道, 所以在执行任何针对性代码之前都需要进行判断
        if ( action.actionCode==='customActionCode1' ) {
            // 打印 onCustomAction 的返回结果
            console[result.isEvenNumber? 'warn': 'log'](`customActionCode1 - onActionDone: ${result.isEvenNumber?'偶数':'奇数'} - ${ result.nowTimeStamp }`);
        }
    }
</code></pre></div><h4 id="替换页面接口"><a href="#替换页面接口" class="header-anchor">#</a> 替换页面接口</h4> <div class="language- extra-class"><pre class="language-text"><code>    &lt;script id=&quot;customScript&quot;&gt;
        ({
            // 1. 将脚本配置的 version 改为 1.1 或更大(如果可用)
            options: {
                version:'1.1'
            },
            // 2. 进行页面设置: 替换默认 api, 目前仅开放视图接口的替换 ( 即: pageConfig.apis.listData )
            pageConfig: {
                // 所有自定接口的请求里, 可以直接访问到 vm|axios|config 等引用 ( 同事件钩子 ), params 则是视图信息和页码数
                // 当前支持两种自定义模式: combine-合并 | replace-替换
                // 所有自定义接口的返回值不管如何处理 (combine/replace), 最终都会流入事件钩子, 作为 data
                apis: {
                    // 2.1 合并模式, 仅替换数据源, 接口数据的校验|健全等仍然走预设逻辑
                    listData: function(params) {
                        return axios.post('self.defined/api', params);
                    },
                    // 2.2 替换模式, 除了替换数据源, 也跳过预设的数据校验和其他相关处理
                    listData: {
                        mode:'replace',
                        request: function(params) {
                            return axios.post('self.defined/api', params)
                                .then(function(resp) {
                                    // 需要自己对数据进行校验, errcode|errmsg|data 等仅作示范, 具体字段以接口为准
                                    if ( resp.errcode!==0 ) throw resp.errmsg;
                                    // 也需要自己处理返回值
                                    return resp.data
                                })
                                // 一些健全或报错机制
                                .catch(function(err) {
                                    vm.$message.error(err.toString());
                                })
                        }
                    }
                }
            },
            // 3. 自定义接口的数据会被引入到钩子的 data 中
            hooks: {
                onLoad: function(data) {
                    // 如果使用了自定义接口, 这里的 data 由自定义接口返回
                },
            }
            // ...其他内容省略
        })
    &lt;/script&gt;
</code></pre></div><h3 id="移动端"><a href="#移动端" class="header-anchor">#</a> 移动端</h3> <div class="language- extra-class"><pre class="language-text"><code>    1. 样式模块
        同pc端
    2. 按钮模块
        移动端不支持自定义按钮事件
    3. 模板模块
        -支持 Vue 模板的全功能, 相关文档请查阅: https://cn.vuejs.org/v2/guide/syntax.html
        -模板包含额外的引用:
            vm:         视图页面实例; 可通过 vm.foo | vm.bar() | vm.filter 等实现对页面数据|函数的复用;
            extensions:     自定义脚本模块处所定义脚本扩展 (如有效); 可用于预设默认值|作基本判断或其他扩展, 需要注意的是扩展内 this 指向它自己, 如不了解不建议使用;
            columns:      视图展示项, 由后台配置所得; 某些数据(如创建人/创建时间)是固定存在的, 但是否展示应该以后台配置为准;
            listData:       视图数据;
            showListItemDetail:   跳转详情页的内部逻辑; 如不了解不建议改动;
            getAttachmentUrl:  通过环境变量和附件 id 换取真实附件地址, 不建议改动;
    4. 脚本模块
        同pc端
</code></pre></div><div class="custom-block danger"><div class="language- extra-class"><pre><code>1.需要注意的是: 每一个视图的每一个数据段, 都有自己独立的 id。示例中的图片附件 Attachment1573033420152、标题文本 ShortText1573033397584, 仅指向该示例视图中的字段, 不代表其他任何视图的任何字段。
</code></pre></div></div></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-40a3448a><li class="level-2" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#环境搭建" class="sidebar-link" data-v-40a3448a>环境搭建</a></li><li class="level-2" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#项目工程" class="sidebar-link" data-v-40a3448a>项目工程</a></li><li class="level-2" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#代码结构-entries【入口项目】" class="sidebar-link" data-v-40a3448a>代码结构 --entries【入口项目】</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#portal" class="sidebar-link" data-v-40a3448a>portal</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#mobile" class="sidebar-link" data-v-40a3448a>mobile</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#admin" class="sidebar-link" data-v-40a3448a>admin</a></li><li class="level-2" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#二开规范" class="sidebar-link" data-v-40a3448a>二开规范</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#theme-js-样式变量" class="sidebar-link" data-v-40a3448a>theme.js 样式变量</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#api-ts-api-url" class="sidebar-link" data-v-40a3448a>api.ts API URL</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#site-ts-站点信息" class="sidebar-link" data-v-40a3448a>site.ts 站点信息</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#routes-ts-路由" class="sidebar-link" data-v-40a3448a>routes.ts 路由</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#基于模块包组件开发" class="sidebar-link" data-v-40a3448a>基于模块包组件开发</a></li><li class="level-2" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#添加自定义vue页面" class="sidebar-link" data-v-40a3448a>添加自定义Vue页面</a></li><li class="level-2" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#表单组件开发" class="sidebar-link" data-v-40a3448a>表单组件开发</a></li><li class="level-2" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#列表自定义" class="sidebar-link" data-v-40a3448a>列表自定义</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#pc端" class="sidebar-link" data-v-40a3448a>pc端</a></li><li class="level-3" data-v-40a3448a><a href="/huashuocuicuiBlog/views/sidebargroup/%E4%BA%91%E6%9E%A2%E4%BA%8C%E5%BC%80.html#移动端" class="sidebar-link" data-v-40a3448a>移动端</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div></div></div>
    <script src="/huashuocuicuiBlog/assets/js/app.c8e5c8f8.js" defer></script><script src="/huashuocuicuiBlog/assets/js/3.42fde2ec.js" defer></script><script src="/huashuocuicuiBlog/assets/js/1.5598d007.js" defer></script><script src="/huashuocuicuiBlog/assets/js/30.776a3768.js" defer></script>
  </body>
</html>
